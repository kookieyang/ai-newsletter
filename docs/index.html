<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Amy ðŸŒ¸</title>
<style>
  :root {
    --bg: #0f0f11;
    --surface: #1a1a1f;
    --card: #22222a;
    --card-hover: #2a2a35;
    --border: #2e2e3a;
    --text: #e8e8f0;
    --text-muted: #888899;
    --accent: #c97be8;
    --accent-dim: #8b4ab5;
    --user-bg: #1e1b2e;
    --user-border: #5a3a8a;
    --assistant-bg: #1a1f1a;
    --assistant-border: #2a3a2a;
    --tool-bg: #1a1a24;
    --tool-border: #3a3a50;
    --green: #4ade80;
    --radius: 14px;
    --radius-sm: 8px;
  }
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    background: var(--bg);
    color: var(--text);
    height: 100dvh;
    display: flex;
    flex-direction: column;
    overflow: hidden;
  }

  /* â”€â”€ Header â”€â”€ */
  header {
    padding: 14px 20px;
    background: var(--surface);
    border-bottom: 1px solid var(--border);
    display: flex;
    align-items: center;
    gap: 12px;
    flex-shrink: 0;
  }
  .avatar {
    width: 38px; height: 38px;
    border-radius: 50%;
    background: linear-gradient(135deg, var(--accent-dim), var(--accent));
    display: flex; align-items: center; justify-content: center;
    font-size: 18px; flex-shrink: 0;
  }
  .header-info h1 { font-size: 16px; font-weight: 600; }
  .header-info .status { font-size: 12px; color: var(--text-muted); display: flex; align-items: center; gap: 5px; }
  .status-dot { width: 7px; height: 7px; border-radius: 50%; background: var(--green); animation: pulse 2s infinite; }
  @keyframes pulse { 0%,100%{opacity:1} 50%{opacity:.4} }

  /* â”€â”€ Messages â”€â”€ */
  #messages {
    flex: 1;
    overflow-y: auto;
    padding: 20px 16px;
    display: flex;
    flex-direction: column;
    gap: 6px;
    scroll-behavior: smooth;
  }
  #messages::-webkit-scrollbar { width: 4px; }
  #messages::-webkit-scrollbar-track { background: transparent; }
  #messages::-webkit-scrollbar-thumb { background: var(--border); border-radius: 4px; }

  .msg-group {
    display: flex;
    flex-direction: column;
    gap: 3px;
    max-width: 820px;
    width: 100%;
    align-self: center;
  }
  .msg-group.user { align-items: flex-end; }
  .msg-group.assistant { align-items: flex-start; }

  .msg-label {
    font-size: 11px;
    color: var(--text-muted);
    padding: 0 4px;
    margin-bottom: 2px;
  }

  .bubble {
    padding: 11px 15px;
    border-radius: var(--radius);
    max-width: 82%;
    word-wrap: break-word;
    line-height: 1.6;
    font-size: 14.5px;
    border: 1px solid transparent;
    position: relative;
  }
  .bubble.user {
    background: var(--user-bg);
    border-color: var(--user-border);
    border-bottom-right-radius: 4px;
  }
  .bubble.assistant {
    background: var(--assistant-bg);
    border-color: var(--assistant-border);
    border-bottom-left-radius: 4px;
  }
  .bubble.tool {
    background: var(--tool-bg);
    border-color: var(--tool-border);
    font-family: 'SF Mono', 'Fira Code', monospace;
    font-size: 12.5px;
    max-width: 92%;
    border-radius: var(--radius-sm);
  }

  .tool-header {
    font-size: 11px;
    color: var(--accent);
    margin-bottom: 6px;
    font-weight: 600;
    letter-spacing: 0.02em;
    display: flex; align-items: center; gap: 6px;
  }
  .tool-header::before { content:'âš™'; font-size:10px; }

  /* â”€â”€ Markdown â”€â”€ */
  .md { line-height: 1.7; }
  .md p { margin: 0 0 8px; }
  .md p:last-child { margin-bottom: 0; }
  .md code { background: rgba(255,255,255,.07); padding: 1px 5px; border-radius: 4px; font-family: 'SF Mono', monospace; font-size: 13px; }
  .md pre { background: rgba(0,0,0,.4); border: 1px solid var(--border); border-radius: var(--radius-sm); padding: 12px; overflow-x: auto; margin: 8px 0; }
  .md pre code { background: none; padding: 0; }
  .md h1,.md h2,.md h3 { margin: 12px 0 6px; font-weight: 600; color: var(--text); }
  .md h1 { font-size: 1.3em; } .md h2 { font-size: 1.15em; } .md h3 { font-size: 1.05em; }
  .md ul,.md ol { padding-left: 20px; margin: 6px 0; }
  .md li { margin: 3px 0; }
  .md blockquote { border-left: 3px solid var(--accent-dim); padding-left: 10px; color: var(--text-muted); margin: 6px 0; }
  .md strong { color: #fff; font-weight: 600; }
  .md hr { border: none; border-top: 1px solid var(--border); margin: 10px 0; }
  .md a { color: var(--accent); text-decoration: none; }
  .md a:hover { text-decoration: underline; }

  /* â”€â”€ Images & Videos â”€â”€ */
  .media-gallery {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    margin-top: 10px;
  }
  .media-gallery img, .media-gallery video {
    max-width: 360px;
    max-height: 360px;
    width: auto;
    height: auto;
    border-radius: var(--radius-sm);
    border: 1px solid var(--border);
    cursor: pointer;
    transition: transform 0.15s, box-shadow 0.15s;
    display: block;
  }
  .media-gallery img:hover, .media-gallery video:hover {
    transform: scale(1.02);
    box-shadow: 0 8px 24px rgba(0,0,0,.5);
  }

  /* â”€â”€ Lightbox â”€â”€ */
  #lightbox {
    display: none;
    position: fixed; inset: 0;
    background: rgba(0,0,0,.88);
    z-index: 1000;
    justify-content: center;
    align-items: center;
    cursor: zoom-out;
  }
  #lightbox.open { display: flex; }
  #lightbox img, #lightbox video {
    max-width: 92vw;
    max-height: 92vh;
    border-radius: var(--radius);
    border: 1px solid var(--border);
    box-shadow: 0 20px 60px rgba(0,0,0,.7);
  }

  /* â”€â”€ Timestamp â”€â”€ */
  .ts {
    font-size: 11px;
    color: var(--text-muted);
    padding: 0 4px;
    margin-top: 2px;
  }

  /* â”€â”€ Typing indicator â”€â”€ */
  .typing-indicator {
    display: flex; gap: 5px; align-items: center;
    padding: 12px 15px;
    background: var(--assistant-bg);
    border: 1px solid var(--assistant-border);
    border-radius: var(--radius);
    border-bottom-left-radius: 4px;
    width: fit-content;
  }
  .typing-indicator span {
    width: 7px; height: 7px;
    background: var(--text-muted);
    border-radius: 50%;
    animation: bounce 1.2s infinite;
  }
  .typing-indicator span:nth-child(2) { animation-delay: 0.2s; }
  .typing-indicator span:nth-child(3) { animation-delay: 0.4s; }
  @keyframes bounce { 0%,60%,100%{transform:translateY(0)} 30%{transform:translateY(-6px)} }

  /* â”€â”€ Compose â”€â”€ */
  #compose {
    padding: 14px 16px;
    background: var(--surface);
    border-top: 1px solid var(--border);
    display: flex;
    gap: 10px;
    align-items: flex-end;
    flex-shrink: 0;
  }
  #input-wrap {
    flex: 1;
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 10px 14px;
    display: flex;
    flex-direction: column;
    transition: border-color 0.15s;
  }
  #input-wrap:focus-within { border-color: var(--accent-dim); }
  #input {
    flex: 1; background: none; border: none; outline: none;
    color: var(--text); font-size: 14.5px; line-height: 1.5;
    resize: none; max-height: 160px; min-height: 22px;
    font-family: inherit;
    width: 100%;
  }
  #input::placeholder { color: var(--text-muted); }
  #input-hint {
    font-size: 11px;
    color: var(--text-muted);
    margin-top: 6px;
    text-align: right;
    opacity: 0.7;
  }
  #send-btn {
    width: 40px; height: 40px;
    background: var(--accent-dim);
    border: none; border-radius: 50%;
    cursor: pointer; color: #fff; font-size: 17px;
    display: flex; align-items: center; justify-content: center;
    flex-shrink: 0;
    transition: background 0.15s, transform 0.1s;
  }
  #send-btn:hover { background: var(--accent); }
  #send-btn:active { transform: scale(0.93); }
  #send-btn:disabled { opacity: 0.4; cursor: not-allowed; }

  /* â”€â”€ Status bar â”€â”€ */
  #status-bar {
    position: fixed; top: 60px; left: 50%; transform: translateX(-50%);
    background: var(--card); border: 1px solid var(--border);
    border-radius: 20px; padding: 6px 14px;
    font-size: 12px; color: var(--text-muted);
    opacity: 0; transition: opacity 0.3s;
    pointer-events: none; z-index: 100;
  }
  #status-bar.show { opacity: 1; }

  /* â”€â”€ Empty state â”€â”€ */
  .empty { text-align: center; color: var(--text-muted); padding: 60px 20px; }
  .empty .emoji { font-size: 48px; margin-bottom: 12px; }
  .empty p { font-size: 14px; }
</style>
</head>
<body>

<header>
  <div class="avatar">ðŸŒ¸</div>
  <div class="header-info">
    <h1>Amy</h1>
    <div class="status"><span class="status-dot"></span> Online</div>
  </div>
</header>

<div id="messages">
  <div class="empty"><div class="emoji">ðŸŒ¸</div><p>Loading conversationâ€¦</p></div>
</div>

<div id="compose">
  <div id="input-wrap">
    <textarea id="input" rows="1" placeholder="Message Amyâ€¦"></textarea>
    <div id="input-hint">Ctrl+Enter to send</div>
  </div>
  <button id="send-btn" title="Send (Ctrl+Enter)">â†‘</button>
</div>

<div id="lightbox">
  <img id="lb-img" src="" alt="" style="display:none"/>
  <video id="lb-vid" src="" controls style="display:none"></video>
</div>

<div id="status-bar"></div>

<script>
const SERVER = '';  // same origin
let lastCount = 0;
let isTyping = false;
let sse = null;

// â”€â”€ Markdown renderer (no deps) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderMarkdown(text) {
  if (!text) return '';
  let html = text
    // Escape HTML first
    .replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;')
    // Code blocks
    .replace(/```[\w]*\n?([\s\S]*?)```/g, (_,c)=>`<pre><code>${c.trim()}</code></pre>`)
    // Inline code
    .replace(/`([^`]+)`/g,'<code>$1</code>')
    // Bold + italic
    .replace(/\*\*\*(.+?)\*\*\*/g,'<strong><em>$1</em></strong>')
    .replace(/\*\*(.+?)\*\*/g,'<strong>$1</strong>')
    .replace(/\*(.+?)\*/g,'<em>$1</em>')
    // Headers
    .replace(/^### (.+)$/gm,'<h3>$1</h3>')
    .replace(/^## (.+)$/gm,'<h2>$1</h2>')
    .replace(/^# (.+)$/gm,'<h1>$1</h1>')
    // Horizontal rule
    .replace(/^---+$/gm,'<hr/>')
    // Blockquote
    .replace(/^> (.+)$/gm,'<blockquote>$1</blockquote>')
    // Unordered list
    .replace(/^\s*[-*]\s+(.+)$/gm,'<li>$1</li>')
    // Ordered list  
    .replace(/^\s*\d+\.\s+(.+)$/gm,'<li>$1</li>')
    // Wrap consecutive li items
    .replace(/(<li>.+<\/li>\n?)+/g, m=>`<ul>${m}</ul>`)
    // Links
    .replace(/\[([^\]]+)\]\(([^)]+)\)/g,'<a href="$2" target="_blank">$1</a>')
    // Line breaks / paragraphs
    .split(/\n\n+/)
    .map(p => {
      p = p.trim();
      if (!p) return '';
      if (p.match(/^<(h[1-6]|ul|ol|pre|blockquote|hr)/)) return p;
      return `<p>${p.replace(/\n/g,'<br/>')}</p>`;
    })
    .join('\n');
  return html;
}

// â”€â”€ Format timestamp â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function formatTime(ts) {
  if (!ts) return '';
  const d = new Date(ts);
  return d.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', hour12: true });
}

// â”€â”€ Strip user timestamp prefix [Wed 2026-...] â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function cleanUserText(text) {
  return text.replace(/^\[[^\]]+\]\s*/, '');
}

// â”€â”€ Build media gallery from tool images â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function buildMediaGallery(images) {
  if (!images || images.length === 0) return '';
  const items = images.map(img => {
    const src = `data:${img.mimeType || 'image/png'};base64,${img.data}`;
    return `<img src="${src}" alt="Generated image" onclick="openLightbox(this.src, 'img')"/>`;
  }).join('');
  return `<div class="media-gallery">${items}</div>`;
}

// â”€â”€ Build media gallery from MEDIA: paths â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function extractMediaFromText(text) {
  const mediaPaths = [];
  const cleaned = text.replace(/^MEDIA:\s*(.+)$/gm, (_, p) => {
    mediaPaths.push(p.trim());
    return '';
  }).trim();
  return { cleaned, mediaPaths };
}

function buildPathGallery(paths) {
  if (!paths.length) return '';
  const items = paths.map(p => {
    const ext = p.split('.').pop().toLowerCase();
    const src = `/file?path=${encodeURIComponent(p)}`;
    if (['mp4','webm','mov'].includes(ext)) {
      return `<video src="${src}" controls onclick="openLightbox('${src}', 'vid')"></video>`;
    } else {
      return `<img src="${src}" alt="Media" onclick="openLightbox('${src}', 'img')"/>`;
    }
  }).join('');
  return `<div class="media-gallery">${items}</div>`;
}

// â”€â”€ Render a single message group â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderMessage(msg, idx) {
  const group = document.createElement('div');
  group.className = `msg-group ${msg.role}`;
  group.dataset.idx = idx;

  if (msg.role === 'user') {
    const text = cleanUserText(msg.text || '');
    if (!text.trim()) return null;
    const bubble = document.createElement('div');
    bubble.className = 'bubble user md';
    bubble.innerHTML = renderMarkdown(text);
    const ts = document.createElement('div');
    ts.className = 'ts';
    ts.textContent = formatTime(msg.timestamp);
    group.appendChild(bubble);
    group.appendChild(ts);

  } else if (msg.role === 'assistant') {
    const { cleaned, mediaPaths } = extractMediaFromText(msg.text || '');
    if (!cleaned.trim() && !mediaPaths.length && !msg.toolResults?.some(r => r.images?.length)) return null;

    if (cleaned.trim() || mediaPaths.length) {
      const bubble = document.createElement('div');
      bubble.className = 'bubble assistant md';
      bubble.innerHTML = renderMarkdown(cleaned);

      // Inline MEDIA: paths
      if (mediaPaths.length) {
        bubble.innerHTML += buildPathGallery(mediaPaths);
      }

      group.appendChild(bubble);
    }

    // Tool results with images
    if (msg.toolResults) {
      for (const tr of msg.toolResults) {
        if (tr.images && tr.images.length > 0) {
          const toolBubble = document.createElement('div');
          toolBubble.className = 'bubble tool';
          toolBubble.innerHTML = `<div class="tool-header">Tool output</div>${buildMediaGallery(tr.images)}`;
          group.appendChild(toolBubble);
        }
      }
    }

    const ts = document.createElement('div');
    ts.className = 'ts';
    ts.textContent = formatTime(msg.timestamp);
    group.appendChild(ts);
  }

  return group.children.length > 0 ? group : null;
}

// â”€â”€ Load & render all messages â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function loadMessages(scrollToBottom = true) {
  try {
    const res = await fetch('/api/messages');
    const messages = await res.json();

    const container = document.getElementById('messages');
    const wasAtBottom = container.scrollTop + container.clientHeight >= container.scrollHeight - 80;

    if (messages.length === lastCount && lastCount > 0) return;
    lastCount = messages.length;

    container.innerHTML = '';
    let rendered = 0;

    for (let i = 0; i < messages.length; i++) {
      const el = renderMessage(messages[i], i);
      if (el) { container.appendChild(el); rendered++; }
    }

    if (rendered === 0) {
      container.innerHTML = '<div class="empty"><div class="emoji">ðŸŒ¸</div><p>No messages yet. Say hi!</p></div>';
    }

    if (scrollToBottom || wasAtBottom) {
      container.scrollTop = container.scrollHeight;
    }

    // Remove typing indicator if present
    const ti = document.getElementById('typing');
    if (ti) ti.remove();
    isTyping = false;

  } catch (e) {
    showStatus('Error loading messages');
    console.error(e);
  }
}

// â”€â”€ SSE for real-time updates â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function connectSSE() {
  if (sse) sse.close();
  sse = new EventSource('/api/events');
  sse.onmessage = (e) => {
    const data = JSON.parse(e.data);
    if (data.type === 'update') {
      setTimeout(() => loadMessages(false), 300);
    }
  };
  sse.onerror = () => { setTimeout(connectSSE, 3000); };
}

// â”€â”€ Send message â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function sendMessage() {
  const input = document.getElementById('input');
  const text = input.value.trim();
  if (!text) return;

  input.value = '';
  input.style.height = 'auto';
  document.getElementById('send-btn').disabled = true;

  // Optimistically add user bubble
  const container = document.getElementById('messages');
  const tempGroup = document.createElement('div');
  tempGroup.className = 'msg-group user';
  tempGroup.innerHTML = `<div class="bubble user md">${renderMarkdown(text)}</div>`;
  container.appendChild(tempGroup);
  container.scrollTop = container.scrollHeight;

  // Add typing indicator
  showTyping();

  try {
    const res = await fetch('/api/send', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ text })
    });
    const data = await res.json();
    if (!data.ok) {
      showStatus('Send failed: ' + (data.error || 'unknown'));
    }
  } catch (e) {
    showStatus('Send failed: ' + e.message);
  } finally {
    document.getElementById('send-btn').disabled = false;
  }
}

function showTyping() {
  if (isTyping) return;
  isTyping = true;
  const container = document.getElementById('messages');
  const group = document.createElement('div');
  group.className = 'msg-group assistant';
  group.id = 'typing';
  group.innerHTML = '<div class="typing-indicator"><span></span><span></span><span></span></div>';
  container.appendChild(group);
  container.scrollTop = container.scrollHeight;
}

function showStatus(msg, duration = 3000) {
  const bar = document.getElementById('status-bar');
  bar.textContent = msg;
  bar.classList.add('show');
  setTimeout(() => bar.classList.remove('show'), duration);
}

// â”€â”€ Lightbox â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function openLightbox(src, type) {
  const lb = document.getElementById('lightbox');
  const img = document.getElementById('lb-img');
  const vid = document.getElementById('lb-vid');
  if (type === 'img') {
    img.src = src; img.style.display = 'block'; vid.style.display = 'none';
  } else {
    vid.src = src; vid.style.display = 'block'; img.style.display = 'none';
  }
  lb.classList.add('open');
}
document.getElementById('lightbox').addEventListener('click', () => {
  document.getElementById('lightbox').classList.remove('open');
  document.getElementById('lb-vid').pause?.();
});

// â”€â”€ Input auto-resize + keyboard shortcuts â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const input = document.getElementById('input');
const inputHint = document.getElementById('input-hint');

input.addEventListener('input', () => {
  input.style.height = 'auto';
  input.style.height = Math.min(input.scrollHeight, 160) + 'px';
});

input.addEventListener('keydown', (e) => {
  // Ctrl+Enter or Cmd+Enter to send
  if (e.key === 'Enter' && (e.ctrlKey || e.metaKey)) {
    e.preventDefault();
    sendMessage();
  }
  // Enter alone creates new line (default behavior)
  // Shift+Enter also creates new line (default behavior)
});

input.addEventListener('focus', () => {
  inputHint.style.opacity = '1';
});

input.addEventListener('blur', () => {
  inputHint.style.opacity = '0.7';
});

document.getElementById('send-btn').addEventListener('click', sendMessage);

// â”€â”€ Init â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
loadMessages(true);
connectSSE();
// Periodic fallback poll
setInterval(() => loadMessages(false), 5000);
</script>
</body>
</html>
